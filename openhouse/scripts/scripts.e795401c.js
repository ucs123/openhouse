"use strict";angular.module("openHouseApp",["ngAnimate","ngCookies","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).config(["$routeProvider","$httpProvider",function(a,b){b.defaults.useXDomain=!0,b.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",delete b.defaults.headers.common["X-Requested-With"],b.interceptors.push("HTTPInterceptor"),a.when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",headerSection:!1}).when("/topics",{templateUrl:"views/topics.html",controller:"TopicsCtrl",headerSection:!0}).when("/logout",{template:"",controller:"LogoutCtrl",headerSection:!1}).otherwise({redirectTo:"/login",headerSection:!1})}]).run(["$window","$location",function(a,b){var c=a.localStorage.getItem("oracleId");null===c&&b.path("/login")}]),angular.module("openHouseApp").controller("ApplicationCtrl",["$scope","$rootScope","$window","$location","$route",function(a,b,c,d,e){a.loggedIn=!1,a.$on("openHouseApp.isloggedIn",function(b,c){a.loggedIn=c}),b.$on("$routeChangeSuccess",function(b,f){c.scrollTo(0,0),a.loggedIn=e.current.headerSection;var g=c.localStorage.getItem("oracleId");null===g&&d.path("/login")})}]),angular.module("openHouseApp").controller("LoginCtrl",["$scope","CommonService","$window","$location",function(a,b,c,d){a.user={username:"",password:"",status:""},a.login=function(){a.user.status="progress";var e=b.doLogin(a.user);e.then(function(b){a.user.status="",200===b.status&&(c.localStorage.setItem("oracleId",b.data.userData.employeeID),d.path("/topics"))},function(b){a.user.status="error"})}}]),angular.module("openHouseApp").controller("LogoutCtrl",["$window","$location",function(a,b){a.localStorage.setItem("oracleId",""),b.path("/login")}]),angular.module("openHouseApp").controller("CreateTopicCtrl",["$scope","CommonService","$modalInstance","$window","$rootScope",function(a,b,c,d,e){a.topic={name:"",description:"",status:""},a.close=function(){c.dismiss("cancel")},a.addNewTopic=function(){var c={name:a.topic.name,description:a.topic.description,oracleId:d.localStorage.getItem("oracleId")},f=b.addTopic(c);f.then(function(b){a.topic.status="",200===b.status&&(a.close(),e.$broadcast("openHouseApp.refreshtopics"))},function(b){a.topic.status="error"})}}]),angular.module("openHouseApp").controller("TopicsCtrl",["$scope","CommonService","$window","$modal",function(a,b,c,d){var e,f=new Array;f[0]="January",f[1]="February",f[2]="March",f[3]="April",f[4]="May",f[5]="June",f[6]="July",f[7]="August",f[8]="September",f[9]="October",f[10]="November",f[11]="December",a.topicList=[],a.createTopic=function(){d.open({templateUrl:"views/create-topic.html",controller:"CreateTopicCtrl",backdrop:"static"})},a.vote=function(d,e){if(e===parseInt(c.localStorage.getItem("oracleId")))return!1;var f=b.vote({_id:d,oracleId:c.localStorage.getItem("oracleId")});f.then(function(b){200===b.status&&a.$broadcast("openHouseApp.refreshtopics")},function(a){console.log(a)})},a.deleteTopic=function(d){var e=b.deleteTopic({_id:d,oracleId:c.localStorage.getItem("oracleId")});e.then(function(b){200===b.status&&a.$broadcast("openHouseApp.refreshtopics")},function(a){c.alert("Sorry, you cannot delete this topic.")})},e=function(){var d=b.fetchTopics();d.then(function(b){if(200===b.status){for(var d=b.data.length,e=[],g=0;d>g;g++){var h=new Date(b.data[g].dateAdded);e.push({id:b.data[g]._id,oracleId:b.data[g].oracleId,name:b.data[g].name,selfVoted:parseInt(c.localStorage.getItem("oracleId"))===b.data[g].oracleId,description:b.data[g].description,totalLikes:b.data[g].likedBy.length,selfLiked:-1===b.data[g].likedBy.indexOf(parseInt(c.localStorage.getItem("oracleId")))?!1:!0,dateAdded:f[h.getMonth()]+" "+h.getDate()+" "+h.getFullYear()+" | "+moment(b.data[g].dateAdded).startOf("hour").fromNow(),showDelete:0===b.data[g].likedBy.length&&parseInt(c.localStorage.getItem("oracleId"))===b.data[g].oracleId?!0:!1,canVote:parseInt(c.localStorage.getItem("oracleId"))===b.data[g].oracleId?!1:!0})}a.topicList=e}},function(a){console.log(a)})},a.$on("openHouseApp.refreshtopics",function(){e()}),e()}]),angular.module("openHouseApp").factory("HTTPInterceptor",["$q",function(a){var b=0;return{request:function(c){return-1===c.url.indexOf("partials")&&(c.headers={"Content-Type":-1===c.url.indexOf("login")?"application/x-www-form-urlencoded":"application/json"}),b++,c||a.when(c)},responseError:function(b){return a.reject(b)}}}]),angular.module("openHouseApp").service("CommonService",["$http","$window",function(a,b){var c=this,d="//10.207.5.225:3000/login",e="//10.207.5.225:8000/api/";c.doLogin=function(b){return a({url:d,data:JSON.stringify(b),method:"POST"})},c.vote=function(b){return a({url:e+"vote",data:$.param(b),method:"POST"})},c.fetchTopics=function(b){return a({url:e+"topics",data:JSON.stringify(b),method:"POST"})},c.addTopic=function(b){return a({url:e+"addtopic",data:$.param(b),method:"POST"})},c.deleteTopic=function(b){return a({url:e+"deletetopic",data:$.param(b),method:"POST"})}}]);